pipeline {
    agent any
    
    stages {
        stage('Copy files from FTP to Workstation') {
            steps {
                script {
                    // Define as informações de conexão FTP
                    def ftpServer = 'server'
                    def ftpUsername = 'service_jenkins'
                    def ftpPassword = 'manager'
                    
                    // Pasta no servidor FTP que deseja copiar
                    def remoteFolderPath = '/home'
                    
                    // Pasta no contêiner da workstation onde deseja copiar os arquivos
                    def localFolderPath = '/tmp'
                    
                    // Cria o diretório local no contêiner, se não existir
                    // sh "docker exec server mkdir -p ${localFolderPath}"
                    
                    // Utiliza o plugin Pipeline Utility Steps para copiar os arquivos
                    withCredentials([usernamePassword(credentialsId: 'ftp-credentials', usernameVariable: 'FTP_USER', passwordVariable: 'FTP_PASS')]) {
                        sh """
                            lftp -c 'open -u ${FTP_USER},${FTP_PASS} ${ftpServer}; mirror --verbose ${remoteFolderPath} ${localFolderPath}'
                        """
                    }
                }
            }
        }
    }
}
